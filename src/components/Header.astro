---
import HeaderLink from './HeaderLink.astro';
import { library, icon } from "@fortawesome/fontawesome-svg-core";
import { faGithub, faLinkedin } from "@fortawesome/free-brands-svg-icons";
import { faEnvelope } from "@fortawesome/free-solid-svg-icons";

library.add(faGithub, faLinkedin, faEnvelope);

const linkedInIcon = icon(faLinkedin);
const emailIcon = icon(faEnvelope);
const githubIcon = icon(faGithub);
---


<header class="m-0 px-0 py-5 md:py-8 bg-cyan-950 shadow-md">
	<nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 flex flex-wrap items-center justify-between md:flex-row md:gap-4">
		<!-- Hamburger button (mobile only) -->
		<button
			id="hamburger-btn"
			type="button"
			class="md:hidden text-white p-2 focus:outline-none"
			aria-label="Toggle navigation menu"
			aria-expanded="false"
		>
			<svg id="hamburger-icon" class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
			</svg>
			<svg id="close-icon" class="w-7 h-7 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
			</svg>
		</button>

		<!-- Nav links (hidden on mobile until toggled) -->
		<div class="hidden md:flex my-auto text-white flex-wrap items-center gap-x-4 gap-y-2 md:gap-x-0" id="nav-links">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/resume">Resume</HeaderLink>
			<HeaderLink href="/open-source">Open Source</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/contact">Contact</HeaderLink>
		</div>

		<!-- Social icons (always visible) -->
		<div class="my-auto text-white flex flex-wrap items-center gap-2 sm:gap-3 md:justify-end">
			<HeaderLink class="w-8" href="https://www.linkedin.com/in/carlos-jimenez-7b4a4a1a/" target="_blank">
				<Fragment set:html={linkedInIcon.html} />
			</HeaderLink>
			<HeaderLink class="w-8" href="https://github.com/techgems" target="_blank">
				<Fragment set:html={githubIcon.html} />
			</HeaderLink>
			<HeaderLink class="w-8" href="mailto:cjimenezber@gmail.com" target="_blank">
				<Fragment set:html={emailIcon.html} />
			</HeaderLink>
		</div>

		<!-- Mobile nav dropdown (full width, below the top bar) -->
		<div id="mobile-menu" class="hidden w-full flex-col gap-2 pt-4 pb-2 text-white md:hidden">
			<HeaderLink class="mx-4" href="/">Home</HeaderLink>
			<HeaderLink class="mx-4" href="/resume">Resume</HeaderLink>
			<HeaderLink class="mx-4" href="/open-source">Open Source</HeaderLink>
			<HeaderLink class="mx-4" href="/blog">Blog</HeaderLink>
			<HeaderLink class="mx-4" href="/contact">Contact</HeaderLink>
		</div>
	</nav>
</header>

<script is:inline>
	function setupHamburger() {
		const btn = document.getElementById('hamburger-btn');
		const menu = document.getElementById('mobile-menu');
		if (!btn) return;

		// Remove old listener by cloning
		const newBtn = btn.cloneNode(true);
		btn.parentNode?.replaceChild(newBtn, btn);

		newBtn.addEventListener('click', () => {
			const isOpen = menu?.classList.contains('flex');
			if (isOpen) {
				menu?.classList.remove('flex');
				menu?.classList.add('hidden');
				document.getElementById('hamburger-icon')?.classList.remove('hidden');
				document.getElementById('close-icon')?.classList.add('hidden');
				newBtn.setAttribute('aria-expanded', 'false');
			} else {
				menu?.classList.remove('hidden');
				menu?.classList.add('flex');
				document.getElementById('hamburger-icon')?.classList.add('hidden');
				document.getElementById('close-icon')?.classList.remove('hidden');
				newBtn.setAttribute('aria-expanded', 'true');
			}
		});
	}

	// Run on initial load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', setupHamburger);
	} else {
		setupHamburger();
	}

	// Also run on Astro view transitions (if enabled)
	document.addEventListener('astro:page-load', setupHamburger);
</script>
<style>
	nav a {
		color: var(--black);
		border-bottom: 4px solid transparent;
		text-decoration: none;
	}
	nav a.active {
		text-decoration: none;
		font-weight: 800;
		border-bottom-color: transparent;
	}

	@media (min-width: 768px) {
		nav a.active {
			font-weight: 600;
			border-bottom-color: var(--accent);
		}
	}
</style>
